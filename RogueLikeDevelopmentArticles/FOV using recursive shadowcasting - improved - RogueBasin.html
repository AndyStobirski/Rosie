<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0146)https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script src="./FOV using recursive shadowcasting - improved - RogueBasin_files/analytics.js.download" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app203.us.archive.org';v.server_ms=1419;archive_analytics.send_pageview({});});</script>
<script type="text/javascript" src="./FOV using recursive shadowcasting - improved - RogueBasin_files/bundle-playback.js.download" charset="utf-8"></script>
<script type="text/javascript" src="./FOV using recursive shadowcasting - improved - RogueBasin_files/wombat.js.download" charset="utf-8"></script>
<script type="text/javascript">
  __wm.init("https://web.archive.org/web");
  __wm.wombat("http://roguebasin.roguelikedevelopment.org:80/index.php?title=FOV_using_recursive_shadowcasting_-_improved","20090721163830","https://web.archive.org/","web","/_static/",
	      "1248194310");
</script>
<link rel="stylesheet" type="text/css" href="./FOV using recursive shadowcasting - improved - RogueBasin_files/banner-styles.css">
<link rel="stylesheet" type="text/css" href="./FOV using recursive shadowcasting - improved - RogueBasin_files/iconochive.css">
<!-- End Wayback Rewrite JS Include -->

		
		<meta http-equiv="Content-Style-Type" content="text/css">
		<meta name="generator" content="MediaWiki 1.15.0">
		<meta name="keywords" content="FOV using recursive shadowcasting - improved,Computing LOS for Large Areas,FOV using recursive shadowcasting,Turbo Pascal">
		<link rel="shortcut icon" href="https://web.archive.org/web/20090721163830im_/http://roguebasin.roguelikedevelopment.org/favicon.ico">
		<link rel="search" type="application/opensearchdescription+xml" href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/opensearch_desc.php" title="RogueBasin (en)">
		<link rel="alternate" type="application/rss+xml" title="RogueBasin RSS Feed" href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Special:RecentChanges&amp;feed=rss">
		<link rel="alternate" type="application/atom+xml" title="RogueBasin Atom Feed" href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Special:RecentChanges&amp;feed=atom">
		<title>FOV using recursive shadowcasting - improved - RogueBasin</title>
		<link rel="stylesheet" href="./FOV using recursive shadowcasting - improved - RogueBasin_files/shared.css" type="text/css" media="screen">
		<link rel="stylesheet" href="./FOV using recursive shadowcasting - improved - RogueBasin_files/commonPrint.css" type="text/css" media="print">
		<link rel="stylesheet" href="./FOV using recursive shadowcasting - improved - RogueBasin_files/main.css" type="text/css" media="screen">
		<!--[if lt IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE50Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE55Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 6]><link rel="stylesheet" href="/skins/monobook/IE60Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" href="/skins/monobook/IE70Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<link rel="stylesheet" href="./FOV using recursive shadowcasting - improved - RogueBasin_files/index.php" type="text/css">
		<link rel="stylesheet" href="./FOV using recursive shadowcasting - improved - RogueBasin_files/index(1).php" type="text/css" media="print">
		<link rel="stylesheet" href="./FOV using recursive shadowcasting - improved - RogueBasin_files/index(2).php" type="text/css">
		<link rel="stylesheet" href="./FOV using recursive shadowcasting - improved - RogueBasin_files/index(3).php" type="text/css">
		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?207"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script type="text/javascript">/*<![CDATA[*/
		var skin = "monobook";
		var stylepath = "/skins";
		var wgArticlePath = "/index.php?title=$1";
		var wgScriptPath = "";
		var wgScript = "/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "FOV_using_recursive_shadowcasting_-_improved";
		var wgTitle = "FOV using recursive shadowcasting - improved";
		var wgAction = "view";
		var wgArticleId = "1633";
		var wgIsArticle = true;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 18551;
		var wgVersion = "1.15.0";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]>*/</script>

		<script type="text/javascript" src="./FOV using recursive shadowcasting - improved - RogueBasin_files/wikibits.js.download"><!-- wikibits js --></script><style type="text/css">@import "/web/20090721163830/http://roguebasin.roguelikedevelopment.org/skins/monobook/KHTMLFixes.css";</style>
		<!-- Head Scripts -->
		<script type="text/javascript" src="./FOV using recursive shadowcasting - improved - RogueBasin_files/ajax.js.download"></script>
		<script type="text/javascript" src="./FOV using recursive shadowcasting - improved - RogueBasin_files/index(4).php"><!-- site js --></script>
	</head>
<body class="mediawiki ltr ns-0 ns-subject page-FOV_using_recursive_shadowcasting_-_improved skin-monobook"><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display: block; direction: ltr;"><template shadowrootmode="closed"><div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20090721163830/http%3A//roguebasin.roguelikedevelopment.org/index.php%3Ftitle%3DFOV_using_recursive_shadowcasting_-_improved" scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><div id="wm-ipp-inside">
  <div id="wm-toolbar" style="position:relative;display:flex;flex-flow:row nowrap;justify-content:space-between;">
    <div id="wm-logo" style="/*width:110px;*/padding-top:12px;">
      <a href="https://web.archive.org/web/" title="Wayback Machine home page"><img src="https://web.archive.org/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0"></a>
    </div>
    <div class="c" style="display:flex;flex-flow:column nowrap;justify-content:space-between;flex:1;">
      <form class="u" style="display:flex;flex-direction:row;flex-wrap:nowrap;" target="_top" method="get" action="https://web.archive.org/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved" onfocus="this.focus();this.select();" style="flex:1;" autocomplete="off"><input type="hidden" name="type" value="replay"><input type="hidden" name="date" value="20090721163830"><input type="submit" value="Go">
      </form>
      <div style="display:flex;flex-flow:row nowrap;align-items:flex-end;">
                <div class="s" id="wm-nav-captures" style="flex:1;"><a class="t" href="https://web.archive.org/web/*/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved" title="See a list of every capture for this URL">26 captures</a><div class="r" title="Timespan for captures of this URL">21 Jul 2009 - 8 Aug 2021</div></div>
        <div class="k">
          <a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved" id="wm-graph-anchor">
            <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
              <canvas id="wm-sparkline-canvas" width="700" height="27" border="0"></canvas>
            <div class="yt" style="display: none; width: 25px; height: 27px;"></div><div class="mt" style="display: none; width: 2px; height: 27px;"></div></div>
          </a>
        </div>
      </div>
    </div>
    <div class="n">
      <table>
        <tbody>
          <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
          <tr class="m">
            <td class="b" nowrap="nowrap">Jun</td>
            <td class="c" id="displayMonthEl" title="You are here: 16:38:30 Jul 21, 2009">JUL</td>
            <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20090921155603/http://roguebasin.roguelikedevelopment.org:80/index.php?title=FOV_using_recursive_shadowcasting_-_improved" title="21 Sep 2009"><strong>Sep</strong></a></td>
          </tr>
          <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
          <tr class="d">
            <td class="b" nowrap="nowrap"><img src="https://web.archive.org/_static/images/toolbar/wm_tb_prv_off.png" alt="Previous capture" width="14" height="16" border="0"></td>
            <td class="c" id="displayDayEl" style="width:34px;font-size:22px;white-space:nowrap;" title="You are here: 16:38:30 Jul 21, 2009">21</td>
            <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20090921155603/http://roguebasin.roguelikedevelopment.org:80/index.php?title=FOV_using_recursive_shadowcasting_-_improved" title="15:56:03 Sep 21, 2009"><img src="https://web.archive.org/_static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"></a></td>
          </tr>
          <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
          <tr class="y">
            <td class="b" nowrap="nowrap">2008</td>
            <td class="c" id="displayYearEl" title="You are here: 16:38:30 Jul 21, 2009">2009</td>
            <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20110228014907/http://roguebasin.roguelikedevelopment.org:80/index.php?title=FOV_using_recursive_shadowcasting_-_improved" title="28 Feb 2011"><strong>2011</strong></a></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="r" style="display:flex;flex-flow:column nowrap;align-items:flex-end;justify-content:space-between;">
      <div id="wm-btns" style="text-align:right;height:23px;">
                <span class="xxs">
          <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved#" title="Share via My Web Archive" style="display: none;">
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php" title="Sign In" id="wm-sign-in" style="display: inline-block;">
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web" style="display: none;"></span>
        </span>
                <a class="xxs" href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
        <a id="wm-tb-close" href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved#close" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share" class="xxs">
        <a href="https://web.archive.org/web/20090721163830/http://web.archive.org/screenshot/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved" id="wm-screenshot" title="screenshot" style="visibility: hidden;">
          <span class="wm-icon-screen-shot"></span>
        </a>
        <a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved#" id="wm-video" title="video">
          <span class="iconochive-movies"></span>
        </a>
        <a id="wm-share-facebook" href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved#" data-url="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org:80/index.php?title=FOV_using_recursive_shadowcasting_-_improved" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
        <a id="wm-share-twitter" href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved#" data-url="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org:80/index.php?title=FOV_using_recursive_shadowcasting_-_improved" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
      <div style="padding-right:2px;text-align:right;white-space:nowrap;">
        <a id="wm-expand" class="wm-btn wm-closed" href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved#expand" onclick="__wm.ex(event);return false;"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span class="xxs" style="font-size:80%;">About this capture</span></a>
      </div>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
        <div id="wm-capinfo-notice" source="api"></div>
                <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexa_web_2009)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/alexa_web_2009" target="_new"><span class="wm-title">alexa_web_2009</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  this data is currently not publicly accessible.
	</div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="https://web.archive.org/_static/images/loading.gif" alt="loading"></div>
    </div>
    </div>
  </div></div></div><link rel="stylesheet" type="text/css" href="./FOV using recursive shadowcasting - improved - RogueBasin_files/banner-styles.css"><link rel="stylesheet" type="text/css" href="./FOV using recursive shadowcasting - improved - RogueBasin_files/iconochive.css"><div class="wb-autocomplete-suggestions "></div></template>
</div><div id="wm-ipp-print">The Wayback Machine - https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org:80/index.php?title=FOV_using_recursive_shadowcasting_-_improved</div>
<script type="text/javascript">//<![CDATA[
__wm.bt(700,27,25,2,"web","http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved","20090721163830",1996,"/_static/",["/_static/css/banner-styles.css?v=S1zqJCYt","/_static/css/iconochive.css?v=qtvMKcIJ"], false);
  __wm.rw(1);
//]]></script>
<!-- END WAYBACK TOOLBAR INSERT -->
 
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 id="firstHeading" class="firstHeading">FOV using recursive shadowcasting - improved</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From RogueBasin</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved#column-one">navigation</a>, <a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved#searchInput">search</a></div>			<!-- start content -->
			<p>Code and improvement for recursive shadowcasting - Henri Hakl
</p>
<a name="Introduction" id="Introduction"></a><h2> <span class="mw-headline">Introduction</span></h2>
<p>This text expands the article by Björn Bergström called "FOV using recursive
shadowcasting". The article in question is excellent and describes one of the
best visibility determination algorithms for roguelike environments.
</p><p>The reader is encouraged to read Björn's <a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting" title="FOV using recursive shadowcasting">article on LOS</a>, as this text assumes that the
reader knows the method described. This text offers a subtle improvement to the
algorithm as well as pseudocode. The improvement is primarily one that allows
a more elegant representation, it does not influence the efficiency of the
algorithm.
</p><p>To outline, Björn describes an improvement to Gordon Lipford's shadowcasting
article <a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Computing_LOS_for_Large_Areas" title="Computing LOS for Large Areas">Computing LOS for Large Areas</a> by making use of recursive computation.
Shadowcasting divides the Field of View (FOV) into eight sections and traces
the rows or columns in the sections according to simple laws that ensure that
a minimum of cells need to be investigated: Cells determined to be in shadow
are skipped and cells are generally only visited once (with possible exception
of cells on the boundaries of sections).
</p><p>Björn proceeds to explain finer mechanics in considerable detail and with well
drawn ASCII art. He omits to offer code in the article, but on-site resources
offer an implementation that should suffice for many.
</p>
<a name="Improvement" id="Improvement"></a><h2> <span class="mw-headline">Improvement</span></h2>
<p>Each recursion in the algorithm described by Björn loops through rows/columns
until a break condition is met (row/column ends with obstruction). This works
because any regions closer to the starting point are already finished, and
areas further away are (if appropriate) handled by recursive calls to the
shadowcasting code.
</p><p>For the sake of elegance this breaking condition can be handled differently:
Instead of looping if the break-condition isn't met, it facilitates code
readability to simply create a recursive call to the shadowcaster. The change
does not influence things on an efficiency level, however it does clean up the
code somewhat.
</p><p>Partial pseudocode, describes one octant:
</p>
<pre> Scan(depth, startslope, endslope)
 
   init y
   init x

   while current_slope has not reached endslope do
     if (x,y) within visual range then
       if (x,y) blocked and prior not blocked then
         Scan(depth + 1, startslope, new_endslope)
       if (x,y) not blocked and prior blocked then
         new_startslope
       set (x,y) visible
     progress (x,y)

   regress (x,y)

   if depth &lt; visual range and (x,y) not blocked
     Scan(depth + 1, startslope, endslope)
 end
</pre>
<p><br>
The following code excerpt comes from my own implementation in <a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Turbo_Pascal" title="Turbo Pascal">Turbo Pascal</a>:
</p>
<pre>  mv -&gt; global describing view distance
  mw -&gt; mv * mv

Octants are divided as follows:

    \ 1 | 2 /
   8         3
   --       --
   7         4
    / 6 | 5 \


function GetSlopeStd(x1, y1, x2, y2&nbsp;: single)&nbsp;: single;
begin
  GetSlopeStd&nbsp;:= (x1 - x2) / (y1 - y2);
end;

function GetSlopeInv(x1, y1, x2, y2&nbsp;: single)&nbsp;: single;
begin
  GetSlopeInv&nbsp;:= (y1 - y2) / (x1 - x2);
end;

function GetVisDistance(x1, y1, x2, y2&nbsp;: integer)&nbsp;: integer;
begin
  GetVisDistance&nbsp;:= (x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2);
end;

procedure RecursiveVisibility(e&nbsp;: PCreature; oct, depth&nbsp;: integer; slopeA, slopeB&nbsp;: single);
var
  x, y&nbsp;: integer;
begin
  case oct of
    1&nbsp;: begin
      y&nbsp;:= e^.y - depth;                                                { initialize y }
      x&nbsp;:= round(e^.x - slopeA * depth);                                { initialize z }
      while GetSlopeStd(x, y, e^.x, e^.y) &gt;= slopeB do begin            { while in octant }
        if GetVisDistance(x, y, e^.x, e^.y) &lt;= mw then begin            { if within max visual range }
          if WorldSurface[x, y].entity^.obstruct then begin             { if obstruction }
            if not WorldSurface[x - 1, y].entity^.obstruct then begin   { if no prior obstruction }
              RecursiveVisibility(e, 1, depth + 1, slopeA, GetSlopeStd(x - 0.5, y + 0.5, e^.x, e^.y));
            end;                                                        { ^create recursive scan }
          end else begin                                                { no obstruction }
            if WorldSurface[x - 1, y].entity^.obstruct then begin       { if prior obstruction }
              slopeA&nbsp;:= GetSlopeStd(x - 0.5, y - 0.5, e^.x, e^.y);      { adjust slope for later recursion }
            end;
          end;
          WorldSurface[x, y].visibility&nbsp;:= 3;                           { set block visible }
        end;
        inc(x);
      end;
      dec(x)
    end;
    2&nbsp;: begin
      y&nbsp;:= e^.y - depth;                                                { initialize y }
      x&nbsp;:= round(e^.x - slopeA * depth);                                { initialize z }
      while GetSlopeStd(x, y, e^.x, e^.y) &lt;= slopeB do begin            { while in octant }
        if GetVisDistance(x, y, e^.x, e^.y) &lt;= mw then begin            { if within max visual range }
          if WorldSurface[x, y].entity^.obstruct then begin             { if obstruction }
            if not WorldSurface[x + 1, y].entity^.obstruct then begin   { if no prior obstruction }
              RecursiveVisibility(e, 2, depth + 1, slopeA, GetSlopeStd(x + 0.5, y + 0.5, e^.x, e^.y));
            end;                                                        { ^create recursive scan }
          end else begin                                                { no obstruction }
            if WorldSurface[x + 1, y].entity^.obstruct then begin       { if prior obstruction }
              slopeA&nbsp;:= GetSlopeStd(x + 0.5, y - 0.5, e^.x, e^.y);      { adjust slope for later recursion }
            end;
          end;
          WorldSurface[x, y].visibility&nbsp;:= 3;                           { set block visible }
        end;
        dec(x);
      end;
      inc(x)
    end;
    3&nbsp;: begin
      x&nbsp;:= e^.x + depth;                                                { initialize y }
      y&nbsp;:= round(e^.y + slopeA * depth);                                { initialize z }
      while GetSlopeInv(x, y, e^.x, e^.y) &lt;= slopeB do begin            { while in octant }
        if GetVisDistance(x, y, e^.x, e^.y) &lt;= mw then begin            { if within max visual range }
          if WorldSurface[x, y].entity^.obstruct then begin             { if obstruction }
            if not WorldSurface[x, y - 1].entity^.obstruct then begin   { if no prior obstruction }
              RecursiveVisibility(e, 3, depth + 1, slopeA, GetSlopeInv(x - 0.5, y - 0.5, e^.x, e^.y));
            end;                                                        { ^create recursive scan }
          end else begin                                                { no obstruction }
            if WorldSurface[x, y - 1].entity^.obstruct then begin       { if prior obstruction }
              slopeA&nbsp;:= GetSlopeInv(x + 0.5, y - 0.5, e^.x, e^.y);      { adjust slope for later recursion }
            end;
          end;
          WorldSurface[x, y].visibility&nbsp;:= 3;                           { set block visible }
        end;
        inc(y);
      end;
      dec(y)
    end;
    4&nbsp;: begin
      x&nbsp;:= e^.x + depth;                                                { initialize y }
      y&nbsp;:= round(e^.y + slopeA * depth);                                { initialize z }
      while GetSlopeInv(x, y, e^.x, e^.y) &gt;= slopeB do begin            { while in octant }
        if GetVisDistance(x, y, e^.x, e^.y) &lt;= mw then begin            { if within max visual range }
          if WorldSurface[x, y].entity^.obstruct then begin             { if obstruction }
            if not WorldSurface[x, y + 1].entity^.obstruct then begin   { if no prior obstruction }
              RecursiveVisibility(e, 4, depth + 1, slopeA, GetSlopeInv(x - 0.5, y + 0.5, e^.x, e^.y));
            end;                                                        { ^create recursive scan }
          end else begin                                                { no obstruction }
            if WorldSurface[x, y + 1].entity^.obstruct then begin       { if prior obstruction }
              slopeA&nbsp;:= GetSlopeInv(x + 0.5, y + 0.5, e^.x, e^.y);      { adjust slope for later recursion }
            end;
          end;
          WorldSurface[x, y].visibility&nbsp;:= 3;                           { set block visible }
        end;
        dec(y);
      end;
      inc(y)
    end;
    5&nbsp;: begin
      y&nbsp;:= e^.y + depth;                                                { initialize y }
      x&nbsp;:= round(e^.x + slopeA * depth);                                { initialize z }
      while GetSlopeStd(x, y, e^.x, e^.y) &gt;= slopeB do begin            { while in octant }
        if GetVisDistance(x, y, e^.x, e^.y) &lt;= mw then begin            { if within max visual range }
          if WorldSurface[x, y].entity^.obstruct then begin             { if obstruction }
            if not WorldSurface[x + 1, y].entity^.obstruct then begin   { if no prior obstruction }
              RecursiveVisibility(e, 5, depth + 1, slopeA, GetSlopeStd(x + 0.5, y - 0.5, e^.x, e^.y));
            end;                                                        { ^create recursive scan }
          end else begin                                                { no obstruction }
            if WorldSurface[x + 1, y].entity^.obstruct then begin       { if prior obstruction }
              slopeA&nbsp;:= GetSlopeStd(x + 0.5, y + 0.5, e^.x, e^.y);      { adjust slope for later recursion }
            end;
          end;
          WorldSurface[x, y].visibility&nbsp;:= 3;                           { set block visible }
        end;
        dec(x);
      end;
      inc(x)
    end;
    6&nbsp;: begin
      y&nbsp;:= e^.y + depth;                                                { initialize y }
      x&nbsp;:= round(e^.x + slopeA * depth);                                { initialize z }
      while GetSlopeStd(x, y, e^.x, e^.y) &lt;= slopeB do begin            { while in octant }
        if GetVisDistance(x, y, e^.x, e^.y) &lt;= mw then begin            { if within max visual range }
          if WorldSurface[x, y].entity^.obstruct then begin             { if obstruction }
            if not WorldSurface[x - 1, y].entity^.obstruct then begin   { if no prior obstruction }
              RecursiveVisibility(e, 6, depth + 1, slopeA, GetSlopeStd(x - 0.5, y - 0.5, e^.x, e^.y));
            end;                                                        { ^create recursive scan }
          end else begin                                                { no obstruction }
            if WorldSurface[x - 1, y].entity^.obstruct then begin       { if prior obstruction }
              slopeA&nbsp;:= GetSlopeStd(x - 0.5, y + 0.5, e^.x, e^.y);      { adjust slope for later recursion }
            end;
          end;
          WorldSurface[x, y].visibility&nbsp;:= 3;                           { set block visible }
        end;
        inc(x);
      end;
      dec(x)
    end;
    7&nbsp;: begin
      x&nbsp;:= e^.x - depth;                                                { initialize y }
      y&nbsp;:= round(e^.y - slopeA * depth);                                { initialize z }
      while GetSlopeInv(x, y, e^.x, e^.y) &lt;= slopeB do begin            { while in octant }
        if GetVisDistance(x, y, e^.x, e^.y) &lt;= mw then begin            { if within max visual range }
          if WorldSurface[x, y].entity^.obstruct then begin             { if obstruction }
            if not WorldSurface[x, y + 1].entity^.obstruct then begin   { if no prior obstruction }
              RecursiveVisibility(e, 7, depth + 1, slopeA, GetSlopeInv(x + 0.5, y + 0.5, e^.x, e^.y));
            end;                                                        { ^create recursive scan }
          end else begin                                                { no obstruction }
            if WorldSurface[x, y + 1].entity^.obstruct then begin       { if prior obstruction }
              slopeA&nbsp;:= GetSlopeInv(x - 0.5, y + 0.5, e^.x, e^.y);      { adjust slope for later recursion }
            end;
          end;
          WorldSurface[x, y].visibility&nbsp;:= 3;                           { set block visible }
        end;
        dec(y);
      end;
      inc(y)
    end;
    8&nbsp;: begin
      x&nbsp;:= e^.x - depth;                                                { initialize y }
      y&nbsp;:= round(e^.y - slopeA * depth);                                { initialize z }
      while GetSlopeInv(x, y, e^.x, e^.y) &gt;= slopeB do begin            { while in octant }
        if GetVisDistance(x, y, e^.x, e^.y) &lt;= mw then begin            { if within max visual range }
          if WorldSurface[x, y].entity^.obstruct then begin             { if obstruction }
            if not WorldSurface[x, y - 1].entity^.obstruct then begin   { if no prior obstruction }
              RecursiveVisibility(e, 8, depth + 1, slopeA, GetSlopeInv(x + 0.5, y - 0.5, e^.x, e^.y));
            end;                                                        { ^create recursive scan }
          end else begin                                                { no obstruction }
            if WorldSurface[x, y - 1].entity^.obstruct then begin       { if prior obstruction }
              slopeA&nbsp;:= GetSlopeInv(x - 0.5, y - 0.5, e^.x, e^.y);      { adjust slope for later recursion }
            end;
          end;
          WorldSurface[x, y].visibility&nbsp;:= 3;                           { set block visible }
        end;
        inc(y);
      end;
      dec(y)
    end;
  end;

  if (depth &lt; mv) and not WorldSurface[x, y].entity^.obstruct then begin   { break/continue }
    RecursiveVisibility(e, oct, depth + 1, slopeA, slopeB);
  end;
end;
</pre>
<a name="Implementation" id="Implementation"></a><h2> <span class="mw-headline">Implementation</span></h2>
<p>A C# 3.0 implementation, including source code, of the above algorithm can be found here<a href="https://web.archive.org/web/20090721163830/http://www.evilscience.co.uk/?p=225" class="external autonumber" title="http://www.evilscience.co.uk/?p=225" rel="nofollow">[1]</a>.
</p>
<!-- 
NewPP limit report
Preprocessor node count: 10/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key rogueliked_db3:pcache:idhash:1633-0!1!0!!en!2!edit=0 and timestamp 20090721005543 -->
<div class="printfooter">
Retrieved from "<a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved">http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved</a>"</div>
			<div id="catlinks" class="catlinks"><div id="mw-normal-catlinks"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Special:Categories" title="Special:Categories">Categories</a>: <span dir="ltr"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Category:Articles" title="Category:Articles">Articles</a></span> | <span dir="ltr"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Category:FOV" title="Category:FOV">FOV</a></span></div></div>			<!-- end content -->
						<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
	
				 <li id="ca-nstab-main" class="selected"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved" title="View the content page [alt-c]" accesskey="c">Page</a></li>
				 <li id="ca-talk"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Talk:FOV_using_recursive_shadowcasting_-_improved" title="Discussion about the content page [alt-t]" accesskey="t">Discussion</a></li>
				 <li id="ca-viewsource"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved&amp;action=edit" title="This page is protected.
You can view its source [alt-e]" accesskey="e">View source</a></li>
				 <li id="ca-history"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved&amp;action=history" title="Past revisions of this page [alt-h]" accesskey="h">History</a></li>			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Special:UserLogin&amp;returnto=FOV_using_recursive_shadowcasting_-_improved" title="You are encouraged to log in; however, it is not mandatory [alt-o]" accesskey="o">Log in / create account</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(/web/20090721163830im_/http://roguebasin.roguelikedevelopment.org/skins/roguebasin/RogueBasin_logo.png);" href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Main_Page" title="Visit the main page [alt-z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>Navigation</h5>
		<div class="pBody">
			<ul>
				<li id="n-mainpage"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Main_Page" title="Visit the main page">Main Page</a></li>
				<li id="n-portal"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=RogueBasin:Community_Portal" title="About the project, what you can do, where to find things">Community portal</a></li>
				<li id="n-recentchanges"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Special:RecentChanges" title="The list of recent changes in the wiki [alt-r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Special:Random" title="Load a random page [alt-x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Help:Contents" title="The place to find out">Help</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php" id="searchform"><div>
				<input type="hidden" name="title" value="Special:Search">
				<input id="searchInput" name="search" type="text" title="Search RogueBasin [alt-f]" accesskey="f" value="">
				<input type="submit" name="go" class="searchButton" id="searchGoButton" value="Go" title="Go to a page with this exact name if exists">&nbsp;
				<input type="submit" name="fulltext" class="searchButton" id="mw-searchButton" value="Search" title="Search the pages for this text">
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Special:WhatLinksHere/FOV_using_recursive_shadowcasting_-_improved" title="List of all wiki pages that link here [alt-j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Special:RecentChangesLinked/FOV_using_recursive_shadowcasting_-_improved" title="Recent changes in pages linked from this page [alt-k]" accesskey="k">Related changes</a></li>
<li id="t-specialpages"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=Special:SpecialPages" title="List of all special pages [alt-q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved&amp;printable=yes" rel="alternate" title="Printable version of this page [alt-p]" accesskey="p">Printable version</a></li>				<li id="t-permalink"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=FOV_using_recursive_shadowcasting_-_improved&amp;oldid=18551" title="Permanent link to this revision of the page">Permanent link</a></li>			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="https://web.archive.org/web/20090721163830/http://www.mediawiki.org/"><img src="./FOV using recursive shadowcasting - improved - RogueBasin_files/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki"></a></div>
			<ul id="f-list">
					<li id="lastmod"> This page was last modified on 19 July 2009, at 21:57.</li>
					<li id="viewcount">This page has been accessed 2,287 times.</li>
					<li id="privacy"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=RogueBasin:Privacy_policy" title="RogueBasin:Privacy policy">Privacy policy</a></li>
					<li id="about"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=RogueBasin:About" title="RogueBasin:About">About RogueBasin</a></li>
					<li id="disclaimer"><a href="https://web.archive.org/web/20090721163830/http://roguebasin.roguelikedevelopment.org/index.php?title=RogueBasin:General_disclaimer" title="RogueBasin:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.271 secs. -->

</body></html>